<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gesture Dashboard</title>
    <style>
        /* --- RESET & LAYOUT --- */
        body { margin: 0; overflow: hidden; background-color: #050505; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; color: #fff; }
        
        /* --- LEFT SIDEBAR (COMMANDS) --- */
        #sidebar {
            width: 300px;
            background: #0a0a0a;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            z-index: 20;
            flex-shrink: 0;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
        }

        .sidebar-header {
            padding: 20px;
            background: #111;
            border-bottom: 1px solid #333;
        }
        
        .sidebar-header h2 { margin: 0; font-size: 1.2rem; color: #00ff88; text-transform: uppercase; letter-spacing: 1px; }
        .sidebar-header p { margin: 5px 0 0 0; font-size: 0.8rem; color: #888; }

        #command-list {
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        }

        /* Command Groups (Pages) */
        .page-group { margin-bottom: 20px; }
        .page-title { 
            font-size: 0.75rem; 
            color: #555; 
            text-transform: uppercase; 
            font-weight: bold; 
            padding: 5px 10px; 
            margin-bottom: 5px;
            border-bottom: 1px solid #222;
        }

        /* Command Items */
        .cmd-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 4px;
            border: 1px solid transparent;
        }

        .cmd-item:hover { background: #1a1a1a; }
        
        /* Active State (Triggered) */
        .cmd-item.active {
            background: rgba(0, 255, 136, 0.15);
            border-color: #00ff88;
        }

        .cmd-icon { font-size: 1.2rem; width: 30px; text-align: center; margin-right: 10px; }
        .cmd-info { display: flex; flex-direction: column; }
        .cmd-name { font-weight: bold; font-size: 0.95rem; }
        .cmd-trigger { font-size: 0.75rem; color: #888; }

        /* --- RIGHT MAIN AREA (ACTIVITY) --- */
        #main-display {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            background: radial-gradient(circle at center, #111 0%, #000 100%);
        }

        canvas { display: block; width: 100%; height: 100%; }

        /* Camera Feed (Floating) */
        #video-container {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            border: 2px solid #333;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
            z-index: 10;
        }
        #webcam { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); opacity: 0.7; }

        /* Page Indicator Overlay */
        #page-toast {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            border: 1px solid #333;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }

        /* --- MOBILE RESPONSIVE --- */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            #sidebar { width: 100%; height: 35vh; border-right: none; border-top: 1px solid #333; order: 2; }
            #main-display { height: 65vh; order: 1; }
            #video-container { width: 100px; height: 75px; top: 10px; right: 10px; bottom: auto; }
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>

    <div id="sidebar">
        <div class="sidebar-header">
            <h2>Gestures</h2>
            <p>Show hand or Click to activate</p>
        </div>
        <div id="command-list">
            </div>
    </div>

    <div id="main-display">
        <div id="page-toast">Page 1</div>
        <div id="video-container">
            <video id="webcam" playsinline muted autoplay></video>
        </div>
        </div>

<script>
    // --- DATA: THE 30 SYMBOLS ---
    // Icons mapped to triggers
    const TRIGGERS = ['âœŠ Fist', 'â˜ï¸ Point', 'âœŒï¸ Victory', 'ðŸ¤Ÿ 3-Fin', 'ðŸ–– 4-Fin', 'ðŸ– Open'];
    
    const LIBRARY = [
        { title: "Page 1: Cosmic", items: [
            { id: 'void', name: 'Singularity', desc: 'Black Hole' },
            { id: 'sphere', name: 'Planet', desc: 'Wireframe Sphere' },
            { id: 'saturn', name: 'Saturn', desc: 'Ringed Planet' },
            { id: 'galaxy', name: 'Galaxy', desc: 'Spiral Arms' },
            { id: 'nebula', name: 'Nebula', desc: 'Star Cloud' },
            { id: 'bigbang', name: 'Big Bang', desc: 'Explosion' }
        ]},
        { title: "Page 2: Geometry", items: [
            { id: 'cube', name: 'Hypercube', desc: 'Box Shape' },
            { id: 'pyramid', name: 'Pyramid', desc: 'Tetrahedron' },
            { id: 'torus', name: 'Donut', desc: 'Torus Ring' },
            { id: 'mobius', name: 'Mobius', desc: 'Twisted Strip' },
            { id: 'klein', name: 'Klein Bottle', desc: 'Mathematical Surface' },
            { id: 'dodeca', name: 'Dodeca', desc: '12-Sided Obj' }
        ]},
        { title: "Page 3: Nature", items: [
            { id: 'seed', name: 'Acorn', desc: 'Compact Seed' },
            { id: 'tree', name: 'Pine Tree', desc: 'Fractal Cone' },
            { id: 'flower', name: 'Rose', desc: 'Petal Pattern' },
            { id: 'leaf', name: 'Fern', desc: 'Leaf Structure' },
            { id: 'mushroom', name: 'Shroom', desc: 'Cap Shape' },
            { id: 'mountain', name: 'Peak', desc: 'Terrain Map' }
        ]},
        { title: "Page 4: Physics", items: [
            { id: 'atom', name: 'Atom', desc: 'Orbiting Electrons' },
            { id: 'dna', name: 'DNA', desc: 'Double Helix' },
            { id: 'wave', name: 'Wave', desc: 'Sine Surface' },
            { id: 'magnet', name: 'Magnet', desc: 'Field Lines' },
            { id: 'fluid', name: 'Fluid', desc: 'Liquid Sim' },
            { id: 'chaos', name: 'Chaos', desc: 'Strange Attractor' }
        ]},
        { title: "Page 5: Symbols", items: [
            { id: 'heart', name: 'Heart', desc: 'Love Symbol' },
            { id: 'star', name: 'Star', desc: 'Super Star' },
            { id: 'diamond', name: 'Gem', desc: 'Crystal' },
            { id: 'skull', name: 'Skull', desc: 'Bone Shape' },
            { id: 'ghost', name: 'Spirit', desc: 'Floating Sheet' },
            { id: 'phoenix', name: 'Phoenix', desc: 'Fire Bird' }
        ]}
    ];

    // --- UI BUILDER ---
    const listContainer = document.getElementById('command-list');
    
    LIBRARY.forEach((page, pageIdx) => {
        // Create Section Header
        const header = document.createElement('div');
        header.className = 'page-title';
        header.innerText = page.title;
        listContainer.appendChild(header);

        // Create Items
        page.items.forEach((item, itemIdx) => {
            const el = document.createElement('div');
            el.className = 'cmd-item';
            el.id = `cmd-${pageIdx}-${itemIdx}`; // Unique ID
            el.innerHTML = `
                <div class="cmd-icon">${TRIGGERS[itemIdx].split(' ')[0]}</div>
                <div class="cmd-info">
                    <span class="cmd-name">${item.name}</span>
                    <span class="cmd-trigger">${TRIGGERS[itemIdx]}</span>
                </div>
            `;
            // Click to activate
            el.onclick = () => {
                STATE.page = pageIdx;
                STATE.gestureIdx = itemIdx;
                updateShapeFromState();
            };
            listContainer.appendChild(el);
        });
    });

    // --- STATE ---
    const STATE = {
        page: 0,
        gestureIdx: 5, // Start with 'Big Bang' (Open hand)
        isMobile: /Mobi|Android/i.test(navigator.userAgent)
    };

    // --- THREE.JS ENGINE ---
    const mainArea = document.getElementById('main-display');
    const PARTICLE_COUNT = STATE.isMobile ? 12000 : 25000;
    
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, mainArea.clientWidth / mainArea.clientHeight, 0.1, 1000);
    camera.position.z = 40;

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(mainArea.clientWidth, mainArea.clientHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    mainArea.appendChild(renderer.domElement);

    // Particles
    const geometry = new THREE.BufferGeometry();
    const positions = new Float32Array(PARTICLE_COUNT * 3);
    const targetPositions = new Float32Array(PARTICLE_COUNT * 3);
    const colors = new Float32Array(PARTICLE_COUNT * 3);
    
    for(let i=0; i<PARTICLE_COUNT; i++) {
        positions[i*3] = (Math.random()-0.5)*100;
        positions[i*3+1] = (Math.random()-0.5)*100;
        positions[i*3+2] = (Math.random()-0.5)*100;
        targetPositions[i*3] = positions[i*3];
        colors[i*3]=1; colors[i*3+1]=1; colors[i*3+2]=1;
    }
    geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    
    const material = new THREE.PointsMaterial({ size: STATE.isMobile?0.25:0.15, vertexColors: true, blending: THREE.AdditiveBlending, transparent: true, opacity: 0.8 });
    const particles = new THREE.Points(geometry, material);
    scene.add(particles);

    // --- MATH & SHAPES ---
    function getTarget(id, u, v, i) {
        let x=0, y=0, z=0;
        const PI = Math.PI;
        // Reuse the math from previous version (simplified for brevity)
        // You can paste the full math block here if needed, I'll use a subset for demo
        switch(id) {
            case 'void': x=(Math.random()-0.5)*2; y=(Math.random()-0.5)*2; break;
            case 'sphere': x=15*Math.sin(2*PI*u)*Math.cos(2*PI*v); y=15*Math.sin(2*PI*u)*Math.sin(2*PI*v); z=15*Math.cos(2*PI*u); break;
            case 'galaxy': const r=u*25; const a=r+i*0.05; x=r*Math.cos(a); z=r*Math.sin(a); y=(Math.random()-0.5)*5; break;
            case 'pyramid': const h=(u-0.5)*20; const s=(1-(h+10)/20)*15; x=(Math.random()-0.5)*s; z=(Math.random()-0.5)*s; y=h; break;
            case 'cube': const c=18; x=(Math.random()-0.5)*c; y=(Math.random()-0.5)*c; z=(Math.random()-0.5)*c; break;
            case 'heart': const t=u*2*PI; x=16*Math.pow(Math.sin(t),3); y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t); z=(v-0.5)*5; break;
            case 'dna': const hd=(u-0.5)*40; const ad=hd*0.5; const st=(i%2==0)?0:PI; x=8*Math.cos(ad+st); z=8*Math.sin(ad+st); y=hd; break;
            default: // Default cloud for unimplemented
                x=(Math.random()-0.5)*30; y=(Math.random()-0.5)*30; z=(Math.random()-0.5)*30;
        }
        return {x,y,z};
    }

    // Color Maps
    const COLORS = [ [0,0.5,1], [0,1,0], [1,0.5,0], [0,1,1], [1,0,0.5] ]; // Per page

    function updateShapeFromState() {
        const page = LIBRARY[STATE.page];
        const item = page.items[STATE.gestureIdx];
        const theme = COLORS[STATE.page];

        // Highlight UI
        document.querySelectorAll('.cmd-item').forEach(el => el.classList.remove('active'));
        const activeEl = document.getElementById(`cmd-${STATE.page}-${STATE.gestureIdx}`);
        if(activeEl) {
            activeEl.classList.add('active');
            activeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Show Toast
        const toast = document.getElementById('page-toast');
        toast.innerText = `${page.title.split(':')[0]} - ${item.name}`;
        toast.style.opacity = 1;
        setTimeout(() => toast.style.opacity = 0, 2000);

        // Update Particles
        for(let i=0; i<PARTICLE_COUNT; i++) {
            const u = Math.random();
            const v = Math.random();
            const pos = getTarget(item.id, u, v, i);
            targetPositions[i*3] = pos.x;
            targetPositions[i*3+1] = pos.y;
            targetPositions[i*3+2] = pos.z;
            
            // Apply Theme Color
            colors[i*3] = theme[0]; colors[i*3+1] = theme[1]; colors[i*3+2] = theme[2];
        }
        particles.geometry.attributes.color.needsUpdate = true;
    }

    // --- HAND TRACKING ---
    let pageCooldown = false;
    
    function onResults(results) {
        if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) return;
        
        const lm = results.multiHandLandmarks[0];
        
        // Count fingers
        const isExt = (t, p) => lm[t].y < lm[p].y;
        const fingers = [
            (lm[4].x < lm[3].x), // Thumb (Right hand assumption, works okay for interaction)
            isExt(8,6), isExt(12,10), isExt(16,14), isExt(20,18)
        ];
        const count = fingers.filter(Boolean).length;

        // Page Navigation (Thumbs Up/Down)
        const isThumbUp = lm[4].y < lm[3].y && lm[4].y < lm[8].y && !fingers[1] && !fingers[2];
        const isThumbDown = lm[4].y > lm[3].y && lm[4].y > lm[17].y && !fingers[1] && !fingers[2];

        if ((isThumbUp || isThumbDown) && !pageCooldown) {
            if (isThumbUp) STATE.page = (STATE.page + 1) % 5;
            else STATE.page = (STATE.page - 1 + 5) % 5;
            
            pageCooldown = true;
            setTimeout(() => pageCooldown = false, 1500);
            updateShapeFromState();
            return;
        }

        // Gesture Selection (0-5)
        // If 5 fingers, idx=5. If 0 fingers, idx=0.
        let newIdx = count;
        if (newIdx > 5) newIdx = 5;

        if (newIdx !== STATE.gestureIdx && !pageCooldown) {
            STATE.gestureIdx = newIdx;
            updateShapeFromState();
        }
    }

    // --- INIT ---
    const vid = document.getElementById('webcam');
    const hands = new Hands({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});
    hands.setOptions({maxNumHands:1, modelComplexity:0});
    hands.onResults(onResults);
    
    const cam = new Camera(vid, {
        onFrame: async () => await hands.send({image: vid}),
        width: 640, height: 480, facingMode: 'user'
    });
    cam.start();

    // Loop
    function animate() {
        requestAnimationFrame(animate);
        const pos = particles.geometry.attributes.position.array;
        for(let i=0; i<PARTICLE_COUNT*3; i++) {
            pos[i] += (targetPositions[i]-pos[i])*0.08;
        }
        particles.geometry.attributes.position.needsUpdate = true;
        particles.rotation.y += 0.002;
        renderer.render(scene, camera);
    }
    animate();
    
    // Initial Trigger
    updateShapeFromState();

    // Resize
    window.addEventListener('resize', () => {
        camera.aspect = mainArea.clientWidth / mainArea.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(mainArea.clientWidth, mainArea.clientHeight);
    });

</script>
</body>
</html>

